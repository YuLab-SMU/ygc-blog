{"MyPackages/ggtree/可交互的ggtree":{"slug":"MyPackages/ggtree/可交互的ggtree","filePath":"MyPackages/ggtree/可交互的ggtree.md","title":"可交互的ggtree","links":[],"tags":["ggtree","interactive"],"content":"\n\n开发ggtree就是我的使命！\n\n可交互这个功能是GISAID的创始人Peter Bogner和我提出来的，我们拉了个线上Zoom会议，聊了聊。于是我和双斌就着手来做这下事情。\n当我们做了个demo，发给他们的时候，跟我说，两周后WHO要开会选疫苗株，他们把数据整理了发我，我来帮他们画。\n\n这时候，我基本上就有求必应，乃至于说加班加点也要帮他们弄了。因为可以说，这是在给世界做贡献。\nggtree的交互，出现得悄无声息\nlibrary(ggtree)\n \n  \nset.seed(123)\ntr &lt;- rtree(20)\n# 这是静态的，和原来一样\np &lt;- ggtree(tr)\n \n# 交互开关，这第二个p，是可交互的图了\nggtree_set_interactive()\np\n\n就是这么简单，这是一个截图，所以看不出啥，但我们从红色框出来的地方，可以看到，这是一张html的【可交互】的图。\n当然这张图，事实上我们没有任何可交互的设置，它其实是没有交互元素的可交互图，有点绕口，但差不多可以说，搞了个寂寞。\n但它就是这么简单，有个开头，你开了，是交互的，关了，是静态的。你感觉不到它的存在。这就是我们所追求的，极致的简单，没有学习成本。\n就这个事情，双斌给我提了意见，说搞个寂寞这种，要给个warning。\n\n我给他的回复就是，搞个寂寞在某个场景下，或者是有用的。我再加个开关，可以关掉warning。\n\n没错，我们就是这么细节控，这样才做到了，呈现给大家的是极致的简单。\n怎么样可交互？\n你基本上只需要知道，加多了两个映射，就可以了：\n\ndata_id 为图形元素分配唯一标识符，用于JavaScript回调函数的元素识别，实现交互功能。\ntooltip 为图形元素添加鼠标悬停提示框，当鼠标悬停时，显示自定义信息。\n\n核心就这些，其它的以后再讲。\n让我们来看一个真正的可交互图：\np2 &lt;- ggtree(\n       tr,\n       mapping = aes(\n           tooltip = round(branch.length, 2),\n           data_id = node\n         )\n   )\n \np2\n代码简单吧，显示的信息是保留两个小数点的分支长度。\n\n鼠标悬停，信息出现，就这样简单。\n然后我们照常加图层，你可以在多个图层都设置有悬停，都是可以的。\ndt &lt;- data.frame(id = c(36, 38), type=c(&quot;A&quot;, &quot;B&quot;))\n \np3 &lt;- p2 +\n     geom_hilight(\n        data = dt,\n        mapping = aes(\n           node = id,\n           fill = type,\n           tooltip = paste0(&quot;clade of node &quot;, id),\n           data_id = type\n        ),\n        to.bottom = TRUE\n     )\n \np3\n\n眼尖的你可能发现，这张截图，高亮的区域和legend对应不上，其实是对着的，没有问题。你看到的不一样，是因为我截图的是鼠标正好悬停在上面，鼠标悬停会高亮相应的图形元素，就像上一张图，在分支上，那个分支就有了颜色一样，所以相当于叠多了个颜色，就看着不一样。当我们把鼠标移开之后，它就是原来的颜色，是一模一样的。\n然后可交互图，一般不是只给你导出PNG, SVG这些，不给保存PDF？\n让我们把交互特性给关了。\nggtree_unset_interactive()\n\np3\n\n\n这就是美妙之处，零学习成本，静态与交互，随意切换。"},"Tools/Obsidian-Quartz博客系统":{"slug":"Tools/Obsidian-Quartz博客系统","filePath":"Tools/Obsidian-Quartz博客系统.md","title":"Obsidian-Quartz博客系统","links":[],"tags":["blog"],"content":"创建Quartz博客\nQuartz是使用Node.js的，所以首先是需要安装Node.js：\nscoop install nodejs-lts\n从github.com/jackyzha0/quartz下载。然后是安装依赖：\nnpm install\n然后就可以创建博客了：\nnpx quartz create\n与Obsidian的联动\n平时用Obsidian来写东西，但并不是写啥，都会公开。所以对于是否要公开，用一个YAML frontmatter做为开关。\n---\npublish: true\n---\n\ntrue是要发表的，false是不发表的。\n但是Quartz默认是不管的，它并不去识别publish: false这个字段，我们需要修改quartz.config.ts，找到这一段：\nimport * as Plugin from &quot;./quartz/plugins&quot;\n \nconst config: QuartzConfig = {\n  configuration: {\n    // ...\n  },\n  plugins: {\n    transformers: [\n      Plugin.FrontMatter(),\n      // ...\n    ],\n    filters: [\n      // 这里通常有一些默认的 filter，比如 RemoveDrafts 之类的\n    ],\n    emitters: [\n      // ...\n    ],\n  },\n}\n \nexport default config\n在filters里面加上Plugin.ExplicitPublish():\nfilters: [\n  Plugin.ExplicitPublish(),\n  // 如果你还有其他 filter，就按需要保留\n  // Plugin.RemoveDrafts(),\n],\n这样子，就会只发布publish: true的markdown文件。\n构建博客\n设置好之后，就可以用obsidian中的文档来生成博客了，用以下指令：\n# 如需要本地预览，加上  --serve\nnpx quartz build -d ../YuNotebooks -o docs\n\n输入直接用上一层目录的obsidian vault，我的笔记在本地，而生成的博客，只有我标识了publish: true的部分，输入的html文档，就放到docs文件夹里，方便后面在GitHub上指定它为Pages。\n但是这里还是有一个问题，就是publish: false的md虽然不会被渲染，但是对应的assets文件夹（放图片，用的Custom Attachment Location）这些还是会被拷贝到docs目录下，必须要写个脚本来清除它，于是就写了一个cleanup_public_no_html.py的脚本。\n然后还有一个问题，就是插入的图片是![](assets/xxx)这种形式，在把md渲染成html的时候，它会把这个目录当成是根目录下的，结果就是md文件如果放一层目录，就会变成../assets/xxx，放两层目录下，就会变成../../assets/xxx，这样子图片就会显示不正常，又需要写一个脚本，correct-image-path.py来读取生成的html文件，修改一下路径。\n发布博客\n到这里就没啥了，推送到GitHub，把docs目录选为Pages，打完收工。"},"index":{"slug":"index","filePath":"index.md","title":"Guangchuang Yu's Blog","links":[],"tags":[],"content":"欢迎来到余光创的博客，主要记录本人在科研工作中的一些经验与思考、科研进展和学习笔记。\n课题组主页\n\n主页：yulab-smu.top/\nGitHub：github.com/YuLab-SMU\n\n课题组公众号\n欢迎关注课题组公众号YuLabSMU。"}}